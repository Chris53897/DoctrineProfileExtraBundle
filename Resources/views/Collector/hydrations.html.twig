{% extends app.request.isXmlHttpRequest ? 'WebProfilerBundle:Profiler:ajax_layout.html.twig' : 'WebProfilerBundle:Profiler:layout.html.twig' %}

{% block toolbar %}
    {% set icon %}
    <img width="20" height="28" alt="Database"
         src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQRJREFUeNpi/P//PwM1ARMDlcGogZQDlpMnT7pxc3NbA9nhQKxOpL5rQLwJiPeBsI6Ozl+YBOOOHTv+AOllQNwtLS39F2owKYZ/gRq8G4i3ggxEToggWzvc3d2Pk+1lNL4fFAs6ODi8JzdS7mMRVyDVoAMHDsANdAPiOCC+jCQvQKqBQB/BDbwBxK5AHA3E/kB8nKJkA8TMQBwLxaBIKQbi70AvTADSBiSadwFXpCikpKQU8PDwkGTaly9fHFigkaKIJid4584dkiMFFI6jkTJII0WVmpHCAixZQEXWYhDeuXMnyLsVlEQKI45qFBQZ8eRECi4DBaAlDqle/8A48ip6gAADANdQY88Uc0oGAAAAAElFTkSuQmCC"/>
    <span class="sf-toolbar-status{% if 50 < collector.hydrationsCount %} sf-toolbar-status-yellow{% endif %}">{{ collector.hydrationsCount }}</span>
    {% if collector.hydrationsCount > 0 %}
        <span class="sf-toolbar-info-piece-additional-detail">in {{ '%0.2f'|format(collector.time * 1000) }} ms</span>
    {% endif %}
    {% endset %}
    {% set text %}
    <div class="sf-toolbar-info-piece">
        <b>Doctrine Hydrations:</b>
    </div>
    {% endset %}
    {% include 'WebProfilerBundle:Profiler:toolbar_item.html.twig' with { 'link': profiler_url } %}
{% endblock %}

{% block menu %}
    <span class="label">
    <span class="icon"><img
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAcCAYAAAB/E6/TAAABLUlEQVR42u3TP0vDQBiA8UK/gDiLzi0IhU4OEunk5OQUAhGSOBUCzqWfIKSzX8DRySF0URCcMjWLIJjFD9Cpk/D6HITecEPUuzhIAz8CIdyTP/f2iqI4qaqqDx8l5Ic2uIeP/bquezCokOAFF+oCN3t4gPzSEjc4NEPaCldQbzjELTYW0RJzHDchwwem+ons6ZBpLSJ7nueJC22h0V+FzmwWV0ee59vQNV67CGVZJmEYbkNjfpY6X6I0Qo4/3RMmTdDDspuQVsJvgkP3IdMbIkIjLPBoadG2646iKJI0Ta2wxm6OdnP0/Tk6DYJgHcfxpw21RtscDTDDnaVZ26474GkkSRIrrPEv5sgMTfHe+cA2O6wPH6vOBpYQNALneHb96XTEDI6dzpEZ0VzO0Rf3pP5LMLI4tAAAAABJRU5ErkJggg=="
                alt=""/></span>
    <strong>Hydrations</strong>
    <span class="count">
        <span>{{ collector.hydrationsCount }}</span>
        <span>{{ '%0.0f'|format(collector.time * 1000) }} ms</span>
    </span>
</span>
{% endblock %}

{% block panel %}
    {% if 'explain' == page %}
        {{ render(controller('DoctrineBundle:Profiler:explain', {
        'token': token,
        'panel': 'db',
        'connectionName': app.request.query.get('connection'),
        'query': app.request.query.get('query')
        })) }}
    {% else %}
        <div>
            <style scoped="scoped">
                h3 {
                    margin-bottom: 0px;
                }

                pre {
                    padding: 5px;
                }
            </style>

            {{ block('hydrations') }}
        </div>
    {% endif %}
{% endblock %}

{% block hydrations %}
    <h2>Hydrations</h2>


    {% if collector.hydrations is empty %}
        <p>
            <em>No hydrations.</em>
        </p>
    {% else %}
        <table class="alt" id="queriesPlaceholder">
            <thead>
            <tr>
                <th onclick="javascript:sortTable(this, 0, 'hydrations')" data-sort-direction="-1"
                    style="cursor: pointer;">#<span>&#9650;</span></th>
                <th onclick="javascript:sortTable(this, 1, 'hydrations')" style="cursor: pointer;">
                    Time<span></span></th>
                <th onclick="javascript:sortTable(this, 2, 'hydrations')" style="cursor: pointer;">
                    Rows<span></span></th>
                <th style="width: 100%;">Alias Map</th>
            </tr>
            </thead>
            <tbody id="hydrations">
            {% for i, hydration in collector.hydrations %}
                <tr id="hydrationNo-{{ i }}" class="{{ cycle(['odd', 'even'], i) }}">
                <td>{{ loop.index }}</td>
                <td>{{ '%0.2f'|format(hydration.executionMS * 1000) }}&nbsp;ms</td>
                <td>{{ hydration.resultNum }}</td>
                <td>
                    <ul>
                    {% for alias, class in hydration.aliasMap %}
                        <li>{{ alias }} => {{ class }}</li>
                    {% endfor %}
                    </ul>
                </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

        <script type="text/javascript">//<![CDATA[

            function sortTable(header, column, targetId) {
                "use strict";

                var direction = parseInt(header.getAttribute('data-sort-direction')) || 1,
                        items = [],
                        target = document.getElementById(targetId),
                        rows = target.children,
                        headers = header.parentElement.children,
                        i;

                for (i = 0; i < rows.length; ++i) {
                    items.push(rows[i]);
                }

                for (i = 0; i < headers.length; ++i) {
                    headers[i].removeAttribute('data-sort-direction');
                    if (headers[i].children.length > 0) {
                        headers[i].children[0].innerHTML = '';
                    }
                }

                header.setAttribute('data-sort-direction', (-1 * direction).toString());
                header.children[0].innerHTML = direction > 0 ? '&#9650;' : '&#9660;';

                items.sort(function (a, b) {
                    return direction * (parseFloat(a.children[column].innerHTML) - parseFloat(b.children[column].innerHTML));
                });

                for (i = 0; i < items.length; ++i) {
                    Sfjs.removeClass(items[i], i % 2 ? 'even' : 'odd');
                    Sfjs.addClass(items[i], i % 2 ? 'odd' : 'even');
                    target.appendChild(items[i]);
                }
            }

            //]]></script>

    {% endif %}

{% endblock hydrations %}
